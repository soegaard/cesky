#lang rac

(require "harness.rac")

(alert "module paths")

(check (module-path? 'rac))
(check (module-path? 'rac/main))
(check (module-path? 'rac/private/main))
(check (module-path? '/rac) #f)
(check (module-path? 'rac/) #f)
(check (module-path? 'rac//main) #f)
(check (module-path? 'rac?) #f)
(check (module-path? 'rac/?/x) #f)

(check (module-path? "main.rac"))
(check (module-path? "private/main.rac"))
(check (module-path? "private/../main.rac"))
(check (module-path? "./../main.rac"))
(check (module-path? "main"))
(check (module-path? "main.rkt"))
(check (module-path? " main.rac "))
(check (module-path? "") #f)
(check (module-path? "a\0b") #f)

(check (module-path? 1) #f)
(check (module-path? '(rac)) #f)

(check (build-module-path 'rac "list.rac") 'rac/list)
(check (build-module-path 'rac/main "list.rac") 'rac/list)
(check (build-module-path 'rac/private/main "list.rac") 'rac/private/list)
(check (build-module-path 'rac "helper/list.rac") 'rac/helper/list)
(check (build-module-path 'rac/main "helper/list.rac") 'rac/helper/list)
(check (build-module-path 'rac/private/main "helper/list.rac") 'rac/private/helper/list)
(check (build-module-path 'rac/private/main "../list.rac") 'rac/list)
(check (build-module-path 'rac/private/main "./list.rac") 'rac/private/list)
(check (build-module-path 'rac/private/main "./././../././list.rac") 'rac/list)
(check-arg-fail (build-module-path 'rac "list") "lacks \".rac\"")
(check-arg-fail (build-module-path 'rac "../list.rac") "too many up elements")
(check-arg-fail (build-module-path 'rac "x//list.rac") "not a relative module library path")
(check-arg-fail (build-module-path 'rac "..//list.rac") "not a relative module library path")
(check-arg-fail (build-module-path 'rac "list@.rac") "not a relative module library path")
(check-arg-fail (build-module-path 'rac "@/list.rac") "not a relative module library path")
(check-arg-fail (build-module-path 'rac "list.rkt") "not a relative module library path")
(check-arg-fail (build-module-path 'rac "x.y/list.rac") "not a relative module library path")

(check (build-module-path "lib/rac/main.rac" "list.rac") "lib/rac/list.rac")
(check (build-module-path "lib/rac/main.rac" "../list.rac") "lib/list.rac")
(check (build-module-path "lib.rac" "list.rac") "list.rac")
(check-arg-fail (build-module-path "lib/rac/main.rac" "list") "lacks \".rac\"")
(check-arg-fail (build-module-path "lib/rac/main.rac" "x//list.rac") "not a relative module library path")
(check-arg-fail (build-module-path "lib/rac/main.rac" "..//list.rac") "not a relative module library path")
(check-arg-fail (build-module-path "lib/rac/main.rac" "list@.rac") "not a relative module library path")
(check-arg-fail (build-module-path "lib/rac/main.rac" "@/list.rac") "not a relative module library path")
(check-arg-fail (build-module-path "lib/rac/main.rac" "list.rkt") "not a relative module library path")
(check-arg-fail (build-module-path "lib/rac/main.rac" "x.y/list.rac") "not a relative module library path")

(check-arg-fail (build-module-path "" "x.rac") "not a module path")
(check-arg-fail (build-module-path 1 "x.rac") "not a module path")
(check-arg-fail (build-module-path "main.rac" 1) "not a module path")
(check-arg-fail (build-module-path 'rac 1) "not a module path")

(check (hash? (module->hash 'rac)))
(check-arg-fail (module->hash 8) "not a module path")
